<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LED Matrix Project - Complete Guide</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
    <style>
      :root {
        --primary: #1a1a2e;
        --secondary: #16213e;
        --accent: #0f3460;
        --highlight: #e94560;
        --text: #f1f1f1;
        --text-muted: #a0a0a0;
        --success: #4ade80;
        --warning: #fbbf24;
        --error: #ef4444;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(
          135deg,
          var(--primary) 0%,
          var(--secondary) 100%
        );
        color: var(--text);
        line-height: 1.7;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
      }

      .header {
        text-align: center;
        margin-bottom: 40px;
        padding: 40px 0;
        background: rgba(26, 26, 46, 0.8);
        border-radius: 15px;
        border: 1px solid rgba(233, 69, 96, 0.3);
      }

      .header h1 {
        font-size: 3rem;
        margin-bottom: 15px;
        background: linear-gradient(45deg, var(--highlight), #ff6b9d);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .header p {
        font-size: 1.2rem;
        color: var(--text-muted);
        margin-bottom: 20px;
      }

      .nav-links {
        display: flex;
        justify-content: center;
        gap: 20px;
        flex-wrap: wrap;
      }

      .nav-link {
        padding: 12px 24px;
        background: var(--highlight);
        color: white;
        text-decoration: none;
        border-radius: 8px;
        transition: all 0.3s ease;
        font-weight: 500;
      }

      .nav-link:hover {
        background: #d63384;
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(233, 69, 96, 0.3);
      }

      .nav-link.secondary {
        background: var(--accent);
        border: 1px solid rgba(233, 69, 96, 0.3);
      }

      .nav-link.secondary:hover {
        background: var(--secondary);
        border-color: var(--highlight);
      }

      .toc {
        position: fixed;
        top: 0;
        left: 0;
        width: 280px;
        height: 100vh;
        background: rgba(26, 26, 46, 0.95);
        backdrop-filter: blur(10px);
        border-right: 1px solid rgba(233, 69, 96, 0.3);
        z-index: 1000;
        overflow-y: auto;
        padding: 2rem 1.5rem;
      }

      .main-content {
        margin-left: 300px;
        min-height: 100vh;
      }

      .toc h3 {
        color: var(--highlight);
        margin-bottom: 20px;
        font-size: 1.2rem;
      }

      .toc ul {
        list-style: none;
      }

      .toc li {
        margin-bottom: 8px;
      }

      .toc a {
        color: var(--text-muted);
        text-decoration: none;
        padding: 8px 12px;
        border-radius: 6px;
        display: block;
        transition: all 0.3s ease;
        font-size: 14px;
      }

      .toc a:hover,
      .toc a.active {
        background: rgba(233, 69, 96, 0.1);
        color: var(--highlight);
        border-left: 3px solid var(--highlight);
      }

      .search-container {
        margin-bottom: 30px;
        padding-bottom: 20px;
        border-bottom: 1px solid rgba(233, 69, 96, 0.2);
      }

      .search-input {
        width: 100%;
        padding: 12px;
        background: rgba(15, 52, 96, 0.3);
        border: 1px solid rgba(233, 69, 96, 0.3);
        border-radius: 8px;
        color: var(--text);
        font-size: 14px;
        margin-bottom: 10px;
      }

      .search-input:focus {
        outline: none;
        border-color: var(--highlight);
        box-shadow: 0 0 0 2px rgba(233, 69, 96, 0.2);
      }

      .search-results {
        max-height: 200px;
        overflow-y: auto;
        background: rgba(15, 52, 96, 0.2);
        border-radius: 6px;
        display: none;
      }

      .search-result {
        padding: 8px 12px;
        border-bottom: 1px solid rgba(233, 69, 96, 0.1);
        cursor: pointer;
        font-size: 13px;
        transition: all 0.3s ease;
      }

      .search-result:hover {
        background: rgba(233, 69, 96, 0.1);
      }

      .search-result:last-child {
        border-bottom: none;
      }

      .search-highlight {
        background: rgba(233, 69, 96, 0.3);
        padding: 2px 4px;
        border-radius: 3px;
      }

      .download-section {
        margin-top: 30px;
        padding-top: 20px;
        border-top: 1px solid rgba(233, 69, 96, 0.2);
      }

      .download-btn {
        display: block;
        width: 100%;
        padding: 12px;
        background: var(--accent);
        border: 1px solid rgba(233, 69, 96, 0.3);
        border-radius: 8px;
        color: var(--text);
        text-decoration: none;
        text-align: center;
        margin-bottom: 10px;
        transition: all 0.3s ease;
        font-size: 14px;
      }

      .download-btn:hover {
        background: var(--highlight);
        border-color: var(--highlight);
        transform: translateY(-1px);
      }

      .download-btn i {
        margin-right: 8px;
      }

      .section {
        margin-bottom: 60px;
        padding: 40px;
        background: rgba(26, 26, 46, 0.7);
        border-radius: 15px;
        border: 1px solid rgba(233, 69, 96, 0.2);
        backdrop-filter: blur(10px);
      }

      .section h2 {
        color: var(--highlight);
        font-size: 2.5rem;
        margin-bottom: 30px;
        text-align: center;
      }

      .section h3 {
        color: var(--text);
        font-size: 1.8rem;
        margin: 30px 0 20px 0;
        border-bottom: 2px solid rgba(233, 69, 96, 0.3);
        padding-bottom: 10px;
      }

      .section h4 {
        color: var(--highlight);
        font-size: 1.3rem;
        margin: 25px 0 15px 0;
      }

      .section p {
        margin-bottom: 20px;
        font-size: 16px;
      }

      .section ul,
      .section ol {
        margin: 20px 0;
        padding-left: 30px;
      }

      .section li {
        margin-bottom: 10px;
      }

      .highlight-box {
        background: linear-gradient(
          135deg,
          rgba(233, 69, 96, 0.1) 0%,
          rgba(233, 69, 96, 0.05) 100%
        );
        border-left: 4px solid var(--highlight);
        padding: 20px;
        margin: 30px 0;
        border-radius: 8px;
      }

      .highlight-box h4 {
        color: var(--highlight);
        margin-top: 0;
      }

      .code-block {
        background: rgba(15, 52, 96, 0.3);
        border: 1px solid rgba(233, 69, 96, 0.2);
        border-radius: 8px;
        padding: 20px;
        margin: 20px 0;
        font-family: "Courier New", monospace;
        overflow-x: auto;
      }

      .component-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin: 30px 0;
      }

      .component-card {
        background: rgba(15, 52, 96, 0.3);
        border: 1px solid rgba(233, 69, 96, 0.2);
        border-radius: 10px;
        padding: 20px;
        transition: all 0.3s ease;
      }

      .component-card:hover {
        border-color: rgba(233, 69, 96, 0.4);
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(233, 69, 96, 0.1);
      }

      .component-card h4 {
        color: var(--highlight);
        margin-bottom: 15px;
      }

      .mermaid-container {
        display: flex;
        justify-content: center;
        min-height: 400px;
        max-height: 800px;
        background: rgba(15, 52, 96, 0.1);
        border: 2px solid rgba(233, 69, 96, 0.3);
        border-radius: 12px;
        padding: 30px;
        margin: 30px 0;
        position: relative;
        overflow: hidden;
      }

      .mermaid {
        width: 100%;
        max-width: 100%;
        height: 100%;
        cursor: grab;
        transition: transform 0.3s ease;
        transform-origin: center center;
        display: flex;
        justify-content: center;
        align-items: center;
        touch-action: none;
        user-select: none;
      }

      .mermaid:active {
        cursor: grabbing;
      }

      .mermaid svg {
        max-width: 100%;
        height: auto;
        display: block;
      }

      .mermaid-controls {
        position: absolute;
        top: 15px;
        right: 15px;
        display: flex;
        gap: 10px;
        z-index: 20;
        background: rgba(26, 26, 46, 0.95);
        padding: 8px;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      .mermaid-control-btn {
        background: rgba(233, 69, 96, 0.2);
        border: 1px solid rgba(233, 69, 96, 0.4);
        border-radius: 6px;
        padding: 10px;
        cursor: pointer;
        transition: all 0.2s ease;
        color: var(--text);
        font-size: 14px;
        min-width: 36px;
        height: 36px;
        text-align: center;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .mermaid-control-btn:hover {
        background: rgba(233, 69, 96, 0.3);
        border-color: rgba(233, 69, 96, 0.6);
        transform: translateY(-1px);
      }

      .mermaid-control-btn:active {
        transform: scale(0.95);
      }

      .dynamic-diagram {
        border: 2px solid var(--highlight);
        background: rgba(233, 69, 96, 0.05);
      }

      .dynamic-diagram h4 {
        position: absolute;
        top: 10px;
        left: 20px;
        background: var(--highlight);
        color: white;
        padding: 5px 15px;
        border-radius: 15px;
        font-size: 12px;
        z-index: 10;
      }

      .table-container {
        overflow-x: auto;
        margin: 20px 0;
      }

      .table-container table {
        width: 100%;
        border-collapse: collapse;
        background: rgba(15, 52, 96, 0.2);
        border-radius: 8px;
        overflow: hidden;
      }

      .table-container th,
      .table-container td {
        padding: 12px 15px;
        text-align: left;
        border-bottom: 1px solid rgba(233, 69, 96, 0.2);
      }

      .table-container th {
        background: rgba(233, 69, 96, 0.2);
        color: var(--text);
        font-weight: 600;
      }

      .table-container tr:hover {
        background: rgba(233, 69, 96, 0.05);
      }

      .footer {
        text-align: center;
        padding: 40px 20px;
        color: var(--text-muted);
        border-top: 1px solid rgba(233, 69, 96, 0.2);
        margin-top: 60px;
      }

      @media (max-width: 1024px) {
        .toc {
          display: none;
        }
        .main-content {
          margin-left: 0;
        }
      }

      @media (max-width: 768px) {
        .header h1 {
          font-size: 2rem;
        }
        .section {
          padding: 20px;
        }
        .nav-links {
          flex-direction: column;
          align-items: center;
        }
      }
    </style>
  </head>
  <body>
    <!-- Table of Contents -->
    <nav class="toc">
      <div class="search-container">
        <h3>🔍 Search</h3>
        <input
          type="text"
          id="search-input"
          placeholder="Search documentation..."
          class="search-input" />
        <div id="search-results" class="search-results"></div>
      </div>

      <h3>📚 Contents</h3>
      <ul>
        <li><a href="#overview">Project Overview</a></li>
        <li><a href="#components">Essential Components</a></li>
        <li><a href="#design">Design & Construction</a></li>
        <li><a href="#wiring">Electrical Wiring</a></li>
        <li><a href="#arduino">Arduino Programming</a></li>
        <li><a href="#python">Python Control</a></li>
        <li><a href="#assembly">Assembly & Testing</a></li>
        <li><a href="#troubleshooting">Troubleshooting</a></li>
        <li><a href="#advanced">Advanced Features</a></li>
        <li><a href="#community">Community & Contributions</a></li>
      </ul>

      <div
        style="
          margin-top: 40px;
          padding-top: 20px;
          border-top: 1px solid rgba(233, 69, 96, 0.2);
        ">
        <h4 style="color: var(--highlight); margin-bottom: 15px">
          📥 Downloads
        </h4>
        <a href="#" class="download-btn" id="download-guide">
          <i class="fas fa-file-pdf"></i>Complete Guide (PDF)
        </a>
        <a href="#" class="download-btn" id="download-wiring">
          <i class="fas fa-sitemap"></i>Wiring Diagrams
        </a>
        <a href="#" class="download-btn" id="download-code">
          <i class="fas fa-code"></i>Arduino Code Pack
        </a>
        <a href="#" class="download-btn" id="download-shopping">
          <i class="fas fa-shopping-cart"></i>Shopping List (CSV)
        </a>

        <h4
          style="
            color: var(--highlight);
            margin-bottom: 15px;
            margin-top: 25px;
          ">
          🔗 Quick Links
        </h4>
        <a
          href="/control"
          class="nav-link"
          style="display: block; text-align: center; margin-bottom: 10px">
          🎮 Control Interface
        </a>
        <a
          href="https://github.com/your-repo"
          class="nav-link secondary"
          style="display: block; text-align: center">
          📦 GitHub Repository
        </a>
      </div>
    </nav>

    <!-- Main Content -->
    <div class="main-content">
      <div class="container">
        <header class="header">
          <h1>🔥 LED Matrix Project</h1>
          <p>
            Complete Guide to Building ARGB LED Matrices for PC Case Modding
          </p>
          <div class="nav-links">
            <a href="/" class="nav-link secondary">� Home</a>I
            <a href="/control" class="nav-link">🎮 Control Interface</a>
            <a href="#overview" class="nav-link secondary">📖 Start Reading</a>
            <a href="#components" class="nav-link secondary"
              >🛒 Shopping List</a
            >
            <a href="#wiring" class="nav-link secondary">🔌 Wiring Guides</a>
          </div>
        </header>

        <!-- Project Overview -->
        <section id="overview" class="section">
          <h2>📋 Project Overview</h2>

          <p>
            Transform your PC case into a dazzling visual display by creating a
            custom <strong>Addressable RGB (ARGB) LED matrix</strong> in the
            space previously occupied by DVD tray drives. Using high-density
            WS2812B LEDs at 144 LEDs per meter, you'll achieve detailed image
            and animation capabilities that will make your PC the centerpiece of
            any room.
          </p>

          <div class="highlight-box">
            <h4>🎯 Key Project Benefits</h4>
            <ul>
              <li>
                <strong>High Visual Impact:</strong> 21×24 matrix (504 LEDs)
                creates stunning displays
              </li>
              <li>
                <strong>Customizable Content:</strong> Display static images,
                animations, or system data
              </li>
              <li>
                <strong>Seamless Integration:</strong> Fits perfectly in
                standard 5.25" drive bays
              </li>
              <li>
                <strong>Beginner-Friendly:</strong> Step-by-step guide with
                detailed explanations
              </li>
            </ul>
          </div>

          <h3>🏗️ Technical Architecture</h3>
          <p>
            The system leverages a powerful combination of hardware and
            software: Arduino microcontrollers handle the real-time LED control,
            while Python scripts on your PC manage image processing and serial
            communication. The WS2812B protocol enables individual LED control
            through a single data line, simplifying wiring while maintaining
            impressive capabilities.
          </p>

          <div class="component-grid">
            <div class="component-card">
              <h4>🎮 Control System</h4>
              <p>
                Python-based controller with GUI and web interface for real-time
                matrix control and pattern generation.
              </p>
            </div>
            <div class="component-card">
              <h4>🔧 Hardware Platform</h4>
              <p>
                Arduino or ESP32 microcontrollers with WS2812B LED strips for
                high-density pixel displays.
              </p>
            </div>
            <div class="component-card">
              <h4>⚡ Power Management</h4>
              <p>
                External 5V power supplies with proper current calculations and
                safety components.
              </p>
            </div>
          </div>
        </section>

        <!-- Essential Components -->
        <section id="components" class="section">
          <h2>🛒 Essential Components</h2>

          <div class="component-grid">
            <div class="component-card">
              <h4>🔌 Arduino Controller</h4>
              <p>
                Choose between Uno or Nano based on space constraints. Both
                offer 5V logic compatibility.
              </p>
              <ul>
                <li><strong>Uno:</strong> Easy prototyping, USB connection</li>
                <li>
                  <strong>Nano:</strong> Compact size, breadboard friendly
                </li>
                <li><strong>ESP32:</strong> WiFi capability, more memory</li>
              </ul>
            </div>

            <div class="component-card">
              <h4>💡 WS2812B LEDs</h4>
              <p>
                144 LEDs/meter density provides exceptional detail with 6.94mm
                spacing between pixels.
              </p>
              <ul>
                <li><strong>Current:</strong> 60mA max per LED</li>
                <li><strong>Control:</strong> Individually addressable</li>
                <li>
                  <strong>Colors:</strong> 16.7 million color combinations
                </li>
              </ul>
            </div>

            <div class="component-card">
              <h4>⚡ Power Supply</h4>
              <p>
                External 5V PSU required. A 504-LED matrix can draw up to 30.24A
                at full brightness.
              </p>
              <ul>
                <li><strong>Voltage:</strong> 5V DC regulated</li>
                <li><strong>Current:</strong> 10A+ recommended</li>
                <li><strong>Safety:</strong> 20% overhead for reliability</li>
              </ul>
            </div>

            <div class="component-card">
              <h4>🛡️ Protection Components</h4>
              <p>
                1000µF capacitor for power smoothing and 330Ω resistor for data
                line protection.
              </p>
              <ul>
                <li><strong>Capacitor:</strong> Voltage stabilization</li>
                <li><strong>Resistor:</strong> Signal integrity</li>
                <li><strong>Fuse:</strong> Overcurrent protection</li>
              </ul>
            </div>
          </div>

          <h3>📋 Complete Shopping List</h3>
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th>Component</th>
                  <th>Specification</th>
                  <th>Quantity</th>
                  <th>Estimated Cost</th>
                  <th>Notes</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Arduino Uno/Nano</td>
                  <td>5V logic, 16MHz</td>
                  <td>1</td>
                  <td>$15-25</td>
                  <td>Main controller</td>
                </tr>
                <tr>
                  <td>WS2812B LEDs</td>
                  <td>144 LEDs/meter</td>
                  <td>504 (21×24)</td>
                  <td>$40-60</td>
                  <td>Adjust based on case size</td>
                </tr>
                <tr>
                  <td>5V Power Supply</td>
                  <td>10A+ capacity</td>
                  <td>1</td>
                  <td>$25-40</td>
                  <td>External PSU required</td>
                </tr>
                <tr>
                  <td>1000µF Capacitor</td>
                  <td>6.3V+ rating</td>
                  <td>1</td>
                  <td>$2-5</td>
                  <td>Power smoothing</td>
                </tr>
                <tr>
                  <td>330Ω Resistor</td>
                  <td>1/4W or higher</td>
                  <td>1</td>
                  <td>$0.50</td>
                  <td>Data line protection</td>
                </tr>
                <tr>
                  <td>Jumper Wires</td>
                  <td>Various lengths</td>
                  <td>Set</td>
                  <td>$5-10</td>
                  <td>Connections</td>
                </tr>
              </tbody>
            </table>
          </div>
        </section>

        <!-- Design & Construction -->
        <section id="design" class="section">
          <h2>🏗️ Design & Construction</h2>

          <h3>📐 Matrix Size Planning</h3>
          <p>
            Standard 5.25" drive bays create an installation area of
            approximately 146mm × 168mm when four bays are stacked vertically.
            With 6.94mm LED spacing, this allows for a 21×24 LED matrix (504
            total LEDs).
          </p>

          <div class="code-block">
            <strong>Calculation Example:</strong><br />
            Width: 146mm ÷ 6.94mm/LED = 21 LEDs<br />
            Height: 168mm ÷ 6.94mm/LED = 24 LEDs<br />
            Total: 21 × 24 = 504 LEDs
          </div>

          <div class="highlight-box">
            <h4>⚠️ Important Note</h4>
            <p>
              Always measure your specific case as dimensions may vary slightly
              between manufacturers.
            </p>
          </div>

          <h3>🔨 Construction Methods</h3>
          <div class="component-grid">
            <div class="component-card">
              <h4>🌟 Flexible LED Strips (Recommended)</h4>
              <p>
                Pre-mounted LEDs with adhesive backing. Cut at designated points
                and arrange in serpentine pattern.
              </p>
              <ul>
                <li>Easy to work with</li>
                <li>Flexible mounting options</li>
                <li>Good for custom shapes</li>
              </ul>
            </div>
            <div class="component-card">
              <h4>🔲 Rigid LED Panels</h4>
              <p>
                Pre-assembled modules offer professional construction but may
                require tiling.
              </p>
              <ul>
                <li>Professional appearance</li>
                <li>Consistent spacing</li>
                <li>May need custom sizing</li>
              </ul>
            </div>
          </div>
        </section>

        <!-- Electrical Wiring -->
        <section id="wiring" class="section">
          <h2>🔌 Electrical Wiring & Circuit Design</h2>

          <p>
            Proper wiring is crucial for reliable operation and safety. This
            section covers the complete electrical design with interactive
            diagrams.
          </p>

          <h3>⚡ Power Distribution</h3>
          <div class="mermaid-container">
            <div class="mermaid">
              graph TB subgraph PSU["5V Power Supply<br />10A+ Capacity"]
              PSU_5V["5V +"] PSU_GND["GND -"] end subgraph CONTROLLER["Arduino
              Uno"] CTRL_VCC["5V Pin"] CTRL_GND["GND Pin"] CTRL_DATA["Pin 6"]
              end subgraph MATRIX["LED Matrix<br />21×24 = 504 LEDs"]
              LED_VCC["VCC/5V"] LED_GND["GND"] LED_DIN["DIN"] end subgraph
              PROTECTION["Protection Components"] CAP["1000µF<br />Capacitor"]
              RES["330Ω<br />Resistor"] end %% Power connections PSU_5V
              -->|"Heavy Wire<br />18 AWG+"| LED_VCC PSU_GND -->|"Heavy Wire<br />18
              AWG+"| LED_GND PSU_GND --> CTRL_GND %% Data connection CTRL_DATA
              --> RES RES --> LED_DIN %% Protection CAP -->|"+5V"| LED_VCC CAP
              -->|"GND"| LED_GND
            </div>
          </div>

          <h3>🔧 Connection Details</h3>
          <div class="highlight-box">
            <h4>Power Connections (Use heavy wire - 18 AWG or thicker)</h4>
            <ul>
              <li>Power Supply 5V+ → LED Matrix VCC/5V</li>
              <li>Power Supply GND → LED Matrix GND</li>
              <li>Power Supply GND → Arduino GND</li>
            </ul>
          </div>

          <div class="highlight-box">
            <h4>Data Connection</h4>
            <ul>
              <li>Arduino Pin 6 → 330Ω Resistor → LED Matrix DIN</li>
            </ul>
          </div>

          <div class="highlight-box">
            <h4>Protection Components</h4>
            <ul>
              <li>
                1000µF Capacitor: + terminal to LED Matrix VCC, - terminal to
                LED Matrix GND
              </li>
              <li>Place capacitor as close to the LED strip as possible</li>
              <li>330Ω Resistor in series with data line</li>
            </ul>
          </div>

          <h3>🎛️ Interactive Diagram Generator</h3>
          <p>
            Generate custom wiring diagrams for your specific setup using our
            integrated diagram generator:
          </p>

          <div class="component-grid">
            <div class="component-card">
              <h4>Controller Type</h4>
              <select
                id="diagram-controller"
                style="
                  width: 100%;
                  padding: 8px;
                  background: rgba(26, 26, 46, 0.8);
                  border: 1px solid rgba(233, 69, 96, 0.3);
                  border-radius: 4px;
                  color: var(--text);
                ">
                <option value="arduino_uno">Arduino Uno</option>
                <option value="arduino_nano">Arduino Nano</option>
                <option value="esp32">ESP32 Dev Board</option>
                <option value="esp8266">ESP8266 NodeMCU</option>
              </select>
            </div>
            <div class="component-card">
              <h4>Matrix Width</h4>
              <input
                type="number"
                id="diagram-width"
                value="16"
                min="1"
                max="64"
                style="
                  width: 100%;
                  padding: 8px;
                  background: rgba(26, 26, 46, 0.8);
                  border: 1px solid rgba(233, 69, 96, 0.3);
                  border-radius: 4px;
                  color: var(--text);
                " />
            </div>
            <div class="component-card">
              <h4>Matrix Height</h4>
              <input
                type="number"
                id="diagram-height"
                value="16"
                min="1"
                max="64"
                style="
                  width: 100%;
                  padding: 8px;
                  background: rgba(26, 26, 46, 0.8);
                  border: 1px solid rgba(233, 69, 96, 0.3);
                  border-radius: 4px;
                  color: var(--text);
                " />
            </div>
            <div class="component-card">
              <h4>Generate</h4>
              <button
                onclick="generateCustomDiagram()"
                class="nav-link"
                style="width: 100%; margin: 0">
                🔧 Generate Diagram
              </button>
            </div>
          </div>

          <div id="custom-diagram-container"></div>
        </section>

        <!-- Arduino Programming -->
        <section id="arduino" class="section">
          <h2>💻 Arduino Programming & Libraries</h2>

          <h3>📚 Required Libraries</h3>
          <p>
            Install these libraries through the Arduino IDE Library Manager:
          </p>
          <ul>
            <li>
              <strong>FastLED:</strong> High-performance LED control library
            </li>
            <li>
              <strong>Adafruit NeoPixel:</strong> Alternative LED library
              (choose one)
            </li>
          </ul>

          <h3>🔧 Basic Arduino Code</h3>
          <div class="code-block">
            #include &lt;FastLED.h&gt; #define DATA_PIN 6 #define NUM_LEDS 504
            #define BRIGHTNESS 128 CRGB leds[NUM_LEDS]; void setup() {
            FastLED.addLeds&lt;WS2812B, DATA_PIN, GRB&gt;(leds, NUM_LEDS);
            FastLED.setBrightness(BRIGHTNESS); Serial.begin(115200); } void
            loop() { // Read commands from serial if (Serial.available()) {
            String command = Serial.readString(); processCommand(command); }
            FastLED.show(); delay(10); } void processCommand(String cmd) { if
            (cmd.startsWith("CLEAR")) { fill_solid(leds, NUM_LEDS, CRGB::Black);
            } else if (cmd.startsWith("RAINBOW")) { rainbow(); } // Add more
            commands as needed } void rainbow() { for (int i = 0; i < NUM_LEDS;
            i++) { leds[i] = CHSV(i * 255 / NUM_LEDS, 255, 255); } }
          </div>

          <div class="highlight-box">
            <h4>💡 Pro Tips</h4>
            <ul>
              <li>
                Use the <strong>Control Interface</strong> to generate optimized
                Arduino code for your specific setup
              </li>
              <li>Start with low brightness (25%) for initial testing</li>
              <li>Monitor current consumption with a multimeter</li>
              <li>Test with a small number of LEDs first</li>
            </ul>
          </div>

          <div
            class="highlight-box"
            style="
              background: rgba(15, 52, 96, 0.1);
              border-left-color: #4ade80;
            ">
            <h4 style="color: #4ade80">🔗 Related Sections</h4>
            <ul>
              <li>
                <a href="#wiring" style="color: #4ade80"
                  >🔌 Electrical Wiring</a
                >
                - Circuit connections and power
              </li>
              <li>
                <a href="#components" style="color: #4ade80"
                  >🛒 Essential Components</a
                >
                - Arduino board selection
              </li>
              <li>
                <a href="#troubleshooting" style="color: #4ade80"
                  >🔍 Troubleshooting</a
                >
                - Common Arduino issues
              </li>
              <li>
                <a href="/control" style="color: #4ade80"
                  >🎮 Control Interface</a
                >
                - Test your Arduino code
              </li>
            </ul>
          </div>
        </section>

        <!-- Python Control -->
        <section id="python" class="section">
          <h2>🐍 Python Control System</h2>

          <p>
            The Python control system provides a comprehensive interface for
            managing your LED matrix with both GUI and web-based controls.
          </p>

          <h3>🚀 Quick Start</h3>
          <div class="code-block">
            # Start the complete system python matrix.py start # Or start
            components individually python matrix.py controller # GUI + API
            server python matrix.py web --control # Web interface only
          </div>

          <h3>🎮 Control Features</h3>
          <div class="component-grid">
            <div class="component-card">
              <h4>🎨 Pattern Generation</h4>
              <ul>
                <li>Solid colors with brightness control</li>
                <li>Rainbow and plasma effects</li>
                <li>Fire and matrix rain animations</li>
                <li>Custom image display</li>
              </ul>
            </div>
            <div class="component-card">
              <h4>⚙️ Code Generation</h4>
              <ul>
                <li>Arduino code for multiple boards</li>
                <li>Automatic board recommendations</li>
                <li>Memory usage calculations</li>
                <li>One-click download</li>
              </ul>
            </div>
            <div class="component-card">
              <h4>🔌 Wiring Guides</h4>
              <ul>
                <li>Interactive wiring diagrams</li>
                <li>Power requirement calculations</li>
                <li>Component shopping lists</li>
                <li>Troubleshooting guides</li>
              </ul>
            </div>
            <div class="component-card">
              <h4>📊 System Monitoring</h4>
              <ul>
                <li>Real-time performance metrics</li>
                <li>Hardware status monitoring</li>
                <li>Configuration management</li>
                <li>Backup and restore</li>
              </ul>
            </div>
          </div>

          <div class="highlight-box">
            <h4>🔗 Access the Control Interface</h4>
            <p>
              Use the
              <a href="/control" style="color: var(--highlight)"
                >Control Interface</a
              >
              for hands-on matrix control, pattern generation, and system
              management.
            </p>
            <div style="margin-top: 15px">
              <strong>Quick Actions:</strong>
              <ul style="margin-top: 8px">
                <li>
                  <a href="/control" style="color: var(--highlight)"
                    >🎨 Try Pattern Generation</a
                  >
                </li>
                <li>
                  <a href="/control" style="color: var(--highlight)"
                    >⚙️ Generate Arduino Code</a
                  >
                </li>
                <li>
                  <a href="/control" style="color: var(--highlight)"
                    >📊 Monitor System Status</a
                  >
                </li>
              </ul>
            </div>
          </div>
        </section>

        <!-- Assembly & Testing -->
        <section id="assembly" class="section">
          <h2>🔧 Assembly & Testing</h2>

          <div class="highlight-box">
            <h4>⚠️ Safety First</h4>
            <ul>
              <li><strong>Always disconnect power</strong> when making wiring changes</li>
              <li><strong>Use fused power supplies</strong> when possible</li>
              <li><strong>Monitor temperature</strong> during extended operation</li>
              <li><strong>Start with low brightness</strong> (25%) for initial testing</li>
            </ul>
          </div>

          <div class="highlight-box" style="background: rgba(76, 175, 80, 0.1); border-left-color: #4caf50;">
            <h4 style="color: #4caf50;">🎯 Interactive Assembly Guide</h4>
            <p>Follow this step-by-step interactive guide with progress tracking and detailed explanations.</p>
            <button id="start-assembly-guide" class="btn" style="background: #4caf50; margin-top: 10px;">
              🚀 Start Interactive Guide
            </button>
          </div>

          <div id="assembly-guide" class="assembly-guide" style="display: none; margin: 30px 0; padding: 30px; background: rgba(15, 52, 96, 0.1); border-radius: 12px;">
            <div class="assembly-progress" style="margin-bottom: 30px;">
              <div class="progress-bar" style="width: 100%; height: 8px; background: rgba(233, 69, 96, 0.2); border-radius: 4px; overflow: hidden;">
                <div class="progress-fill" id="assembly-progress" style="height: 100%; background: #4caf50; width: 8.33%; transition: width 0.3s ease;"></div>
              </div>
              <span id="assembly-step-counter" style="display: block; text-align: center; margin-top: 10px; font-weight: bold;">Step 1 of 12</span>
            </div>
            
            <div class="assembly-steps">
              <div class="assembly-step active" id="step-1">
                <h4>Step 1: Pre-Assembly Preparation 🛡️</h4>
                <div class="step-content">
                  <p><strong>Essential preparation before starting:</strong></p>
                  <ul>
                    <li>✅ Gather all tools and components</li>
                    <li>✅ Set up clean, well-lit workspace</li>
                    <li>✅ Disconnect all power sources</li>
                    <li>✅ Use anti-static precautions</li>
                    <li>✅ Have multimeter ready for testing</li>
                  </ul>
                  <div class="step-media" style="background: rgba(15, 52, 96, 0.3); padding: 20px; text-align: center; border-radius: 8px; margin: 15px 0;">
                    📹 <strong>Video Tutorial:</strong> Workspace Setup & Safety<br>
                    <small style="color: var(--text-muted);">Interactive video tutorial would be embedded here</small>
                  </div>
                  <div class="interactive-checklist">
                    <h5>📋 Pre-Assembly Checklist</h5>
                    <div style="margin: 10px 0;">
                      <label style="display: block; margin: 5px 0;"><input type="checkbox" style="margin-right: 8px;"> Tools gathered (screwdrivers, wire strippers, multimeter)</label>
                      <label style="display: block; margin: 5px 0;"><input type="checkbox" style="margin-right: 8px;"> Components verified (Arduino, LEDs, power supply, resistors)</label>
                      <label style="display: block; margin: 5px 0;"><input type="checkbox" style="margin-right: 8px;"> Workspace prepared (clean, well-lit, anti-static)</label>
                      <label style="display: block; margin: 5px 0;"><input type="checkbox" style="margin-right: 8px;"> Safety equipment ready (safety glasses, proper lighting)</label>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="assembly-navigation" style="display: flex; justify-content: space-between; align-items: center; margin-top: 30px; padding-top: 20px; border-top: 1px solid rgba(233, 69, 96, 0.2);">
              <button id="prev-step" class="btn btn-secondary" disabled>← Previous</button>
              <div id="step-indicator" style="display: flex; gap: 5px;">
                <div class="step-dot active" style="width: 8px; height: 8px; border-radius: 50%; background: #4caf50;"></div>
                <div class="step-dot" style="width: 8px; height: 8px; border-radius: 50%; background: rgba(233, 69, 96, 0.3);"></div>
                <div class="step-dot" style="width: 8px; height: 8px; border-radius: 50%; background: rgba(233, 69, 96, 0.3);"></div>
                <div class="step-dot" style="width: 8px; height: 8px; border-radius: 50%; background: rgba(233, 69, 96, 0.3);"></div>
                <div class="step-dot" style="width: 8px; height: 8px; border-radius: 50%; background: rgba(233, 69, 96, 0.3);"></div>
              </div>
              <button id="next-step" class="btn">Next →</button>
            </div>
          </div>

          <h3>📋 Traditional Assembly Guide</h3>
          
          <h4>Step 1: Case Preparation</h4>
          <div class="code-block">
<strong>Tools Needed:</strong>
• Screwdriver set
• Measuring tape or ruler
• Cleaning supplies
• Masking tape (for marking)

<strong>Process:</strong>
1. Power down PC and disconnect all cables
2. Remove side panel to access drive bays
3. Remove 4 consecutive 5.25" drive bay covers
4. Clean the area thoroughly
5. Measure available space (should be ~146mm × 168mm)
6. Mark LED placement with masking tape
          </div>

          <h4>Step 2: LED Strip Preparation</h4>
          <div class="component-grid">
            <div class="component-card">
              <h4>🔪 Cutting LEDs</h4>
              <ul>
                <li>Cut only at designated cut points (every 3 LEDs)</li>
                <li>Use sharp scissors or wire cutters</li>
                <li>Leave 2-3mm of copper pad for soldering</li>
                <li>Test each strip before installation</li>
              </ul>
            </div>
            <div class="component-card">
              <h4>🔗 Connecting Strips</h4>
              <ul>
                <li>Solder short jumper wires between strips</li>
                <li>Follow serpentine pattern (zigzag)</li>
                <li>Use 22-24 AWG wire for data connections</li>
                <li>Heat shrink all solder joints</li>
              </ul>
            </div>
          </div>

          <div class="mermaid-container">
            <div class="mermaid">
              graph LR
                subgraph "LED Strip Layout (Serpentine Pattern)"
                  A[Strip 1: LEDs 1-21] --> B[Strip 2: LEDs 22-42]
                  B --> C[Strip 3: LEDs 43-63]
                  C --> D[Strip 4: LEDs 64-84]
                  D --> E[Strip 5: LEDs 85-105]
                  E --> F[...]
                end
                
                subgraph "Data Flow"
                  Arduino[Arduino Pin 6] --> R[330Ω Resistor]
                  R --> A
                end
                
                subgraph "Power Distribution"
                  PSU[5V Power Supply] --> PWR[Power Bus]
                  PWR --> A
                  PWR --> B  
                  PWR --> C
                  PWR --> D
                  PWR --> E
                end
            </div>
          </div>

          <h4>Step 3: Power Wiring</h4>
          <div class="highlight-box">
            <h4>🔌 Power Connection Best Practices</h4>
            <ul>
              <li><strong>Wire Gauge:</strong> Use 18 AWG or thicker for power</li>
              <li><strong>Distribution:</strong> Connect power every 2-3 strips to prevent voltage drop</li>
              <li><strong>Polarity:</strong> Double-check positive and negative connections</li>
              <li><strong>Strain Relief:</strong> Secure wires to prevent disconnection</li>
            </ul>
          </div>

          <h4>Step 4: Data Line Connection</h4>
          <div class="code-block">
<strong>Single Data Line Setup:</strong>
Arduino Pin 6 → 330Ω Resistor → First LED DIN

<strong>For ESP32 (3.3V Logic):</strong>
ESP32 Pin 13 → 74HCT125 Level Shifter → 330Ω Resistor → First LED DIN

<strong>Important:</strong>
• Keep data line as short as possible
• Avoid running parallel to power lines
• Use twisted pair if data line is long
• Add ferrite bead if experiencing interference
          </div>

          <h3>🧪 Comprehensive Testing Procedure</h3>

          <div class="component-grid">
            <div class="component-card">
              <h4>1. Pre-Power Checks</h4>
              <ul>
                <li>Visual inspection of all connections</li>
                <li>Continuity test with multimeter</li>
                <li>Verify no short circuits</li>
                <li>Check polarity of all connections</li>
              </ul>
            </div>
            <div class="component-card">
              <h4>2. Power Supply Test</h4>
              <ul>
                <li>Connect PSU without LEDs</li>
                <li>Measure output voltage (should be 5.0V ±0.1V)</li>
                <li>Check ripple with oscilloscope if available</li>
                <li>Verify current limiting works</li>
              </ul>
            </div>
            <div class="component-card">
              <h4>3. Incremental LED Testing</h4>
              <ul>
                <li>Start with first 10 LEDs only</li>
                <li>Upload basic test sketch</li>
                <li>Test red, green, blue individually</li>
                <li>Gradually add more LED strips</li>
              </ul>
            </div>
            <div class="component-card">
              <h4>4. Full System Validation</h4>
              <ul>
                <li>Connect all LEDs</li>
                <li>Monitor current with clamp meter</li>
                <li>Test all patterns and effects</li>
                <li>Run for 30 minutes to check stability</li>
              </ul>
            </div>
          </div>

          <h3>📊 Performance Validation</h3>
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th>Test</th>
                  <th>Expected Result</th>
                  <th>Troubleshooting</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Power Supply Voltage</td>
                  <td>5.0V ±0.1V</td>
                  <td>Check PSU settings, load regulation</td>
                </tr>
                <tr>
                  <td>LED Color Accuracy</td>
                  <td>Pure red, green, blue</td>
                  <td>Check color order in code (GRB vs RGB)</td>
                </tr>
                <tr>
                  <td>Current Consumption</td>
                  <td>≤60mA per LED at full white</td>
                  <td>Reduce brightness if exceeding PSU capacity</td>
                </tr>
                <tr>
                  <td>Data Transmission</td>
                  <td>All LEDs respond to commands</td>
                  <td>Check data line connections, add level shifter</td>
                </tr>
                <tr>
                  <td>Temperature</td>
                  <td>LEDs warm but not hot</td>
                  <td>Improve ventilation, reduce brightness</td>
                </tr>
              </tbody>
            </table>
          </div>

          <h3>🔧 Integration with Python Controller</h3>
          <div class="code-block">
<strong>Step-by-Step Integration:</strong>

1. Upload Arduino sketch to microcontroller
2. Connect USB cable to PC
3. Note the COM port (Windows) or device path (Linux/Mac)
4. Start Python controller:
   python matrix.py controller
5. Configure serial port in settings
6. Test basic commands (clear, solid color)
7. Verify web interface connectivity
8. Test pattern generation and effects

<strong>Verification Commands:</strong>
python matrix.py info          # Check system status
python matrix.py test          # Run test suite
          </div>

          <div class="highlight-box">
            <h4>🎮 Ready to Control!</h4>
            <p>Once assembly and testing are complete, use the <a href="/control" style="color: var(--highlight);">Control Interface</a> for real-time matrix control, pattern generation, and system monitoring.</p>
          </div>
        </section>

        <!-- Troubleshooting -->
        <section id="troubleshooting" class="section">
          <h2>🔍 Troubleshooting Guide</h2>

          <h3>❌ Common Issues and Solutions</h3>

          <div class="component-card" style="margin-bottom: 20px">
            <h4>LEDs Not Lighting Up</h4>
            <ul>
              <li>Check power supply connections (5V+ and GND)</li>
              <li>
                Verify data pin connection (Pin 6 → 330Ω resistor → LED DIN)
              </li>
              <li>Ensure power supply is adequate for the number of LEDs</li>
              <li>Test with a simple sketch that lights up first 10 LEDs</li>
            </ul>
          </div>

          <div class="component-card" style="margin-bottom: 20px">
            <h4>Flickering or Unstable Colors</h4>
            <ul>
              <li>
                Add or check 1000µF capacitor across power rails near LED strip
              </li>
              <li>
                Verify power supply capacity (should be 20% higher than
                calculated requirement)
              </li>
              <li>Check for loose connections, especially power connections</li>
              <li>Reduce brightness in code if power supply is marginal</li>
            </ul>
          </div>

          <div class="component-card" style="margin-bottom: 20px">
            <h4>Wrong Colors or Patterns</h4>
            <ul>
              <li>Verify LED type in code (WS2812B vs WS2811)</li>
              <li>Check color order (GRB vs RGB) in FastLED configuration</li>
              <li>Ensure proper XY mapping function for your wiring pattern</li>
              <li>Test with simple solid colors first</li>
            </ul>
          </div>

          <div class="component-card">
            <h4>Python Controller Issues</h4>
            <ul>
              <li>
                Close Arduino IDE Serial Monitor before running Python scripts
              </li>
              <li>Verify correct COM port in Device Manager (Windows)</li>
              <li>Try different baud rates (115200, 500000)</li>
              <li>Check USB cable (some cables are power-only)</li>
            </ul>
          </div>
        </section>

        <!-- Advanced Features -->
        <section id="advanced" class="section">
          <h2>🚀 Advanced Features</h2>

          <h3>📡 WiFi Control (ESP32/ESP8266)</h3>
          <p>Upgrade to ESP32 or ESP8266 for wireless control capabilities:</p>
          <ul>
            <li>Web server hosted on the microcontroller</li>
            <li>MQTT integration for IoT control</li>
            <li>Over-the-air (OTA) updates</li>
            <li>Integration with home automation systems</li>
          </ul>

          <h3>🎵 Audio Reactive Patterns</h3>
          <p>Add audio input for music-synchronized lighting:</p>
          <ul>
            <li>Microphone input for ambient sound</li>
            <li>Line-in for direct audio feed</li>
            <li>FFT analysis for frequency-based effects</li>
            <li>Beat detection algorithms</li>
          </ul>

          <h3>🖥️ System Integration</h3>
          <p>Display system information on your matrix:</p>
          <ul>
            <li>CPU and GPU temperatures</li>
            <li>System load and memory usage</li>
            <li>Network activity indicators</li>
            <li>Custom notifications and alerts</li>
          </ul>
        </section>

        <!-- Community & Contributions -->
        <section id="community" class="section">
          <h2>🤝 Community & Contributions</h2>

          <p>The LED Matrix Project thrives on community contributions! Whether you're a beginner or expert, there are many ways to get involved and help improve the project for everyone.</p>

          <div class="component-grid">
            <div class="component-card">
              <h4>🐛 Report Issues</h4>
              <p>Found a bug or have a suggestion? Help us improve!</p>
              <ul>
                <li>Check existing issues first</li>
                <li>Provide detailed reproduction steps</li>
                <li>Include system information</li>
                <li>Add screenshots or videos if helpful</li>
              </ul>
              <a href="https://github.com/your-repo/issues" class="btn btn-secondary" style="margin-top: 10px;">Report Issue</a>
            </div>

            <div class="component-card">
              <h4>💡 Share Your Build</h4>
              <p>Show off your LED matrix creation to inspire others!</p>
              <ul>
                <li>Post photos of your completed build</li>
                <li>Share unique patterns or animations</li>
                <li>Document custom modifications</li>
                <li>Help troubleshoot community questions</li>
              </ul>
              <a href="https://github.com/your-repo/discussions" class="btn btn-secondary" style="margin-top: 10px;">Share Build</a>
            </div>

            <div class="component-card">
              <h4>🔧 Contribute Code</h4>
              <p>Help improve the codebase with your programming skills!</p>
              <ul>
                <li>Fix bugs and improve performance</li>
                <li>Add new patterns and effects</li>
                <li>Enhance documentation</li>
                <li>Improve web interfaces</li>
              </ul>
              <a href="https://github.com/your-repo/pulls" class="btn btn-secondary" style="margin-top: 10px;">Submit PR</a>
            </div>

            <div class="component-card">
              <h4>📚 Improve Documentation</h4>
              <p>Help make the project more accessible to newcomers!</p>
              <ul>
                <li>Fix typos and improve clarity</li>
                <li>Add missing explanations</li>
                <li>Create video tutorials</li>
                <li>Translate to other languages</li>
              </ul>
              <a href="https://github.com/your-repo/wiki" class="btn btn-secondary" style="margin-top: 10px;">Edit Docs</a>
            </div>
          </div>

          <h3>🎯 Contribution Guidelines</h3>
          
          <div class="highlight-box">
            <h4>📋 Before Contributing</h4>
            <ol>
              <li><strong>Read the Code of Conduct</strong> - Be respectful and inclusive</li>
              <li><strong>Check existing issues</strong> - Avoid duplicate work</li>
              <li><strong>Start small</strong> - Begin with documentation or small bug fixes</li>
              <li><strong>Ask questions</strong> - Use discussions for clarification</li>
            </ol>
          </div>

          <h4>🔄 Development Workflow</h4>
          <div class="code-block">
<strong>1. Fork and Clone</strong>
git clone https://github.com/your-username/led-matrix-project.git
cd led-matrix-project

<strong>2. Create Feature Branch</strong>
git checkout -b feature/your-feature-name

<strong>3. Make Changes</strong>
# Edit files, add features, fix bugs
python matrix.py test  # Run tests

<strong>4. Commit and Push</strong>
git add .
git commit -m "Add: your feature description"
git push origin feature/your-feature-name

<strong>5. Create Pull Request</strong>
# Go to GitHub and create PR with detailed description
          </div>

          <div class="highlight-box" style="background: rgba(255, 193, 7, 0.1); border-left-color: #ffc107;">
            <h4 style="color: #ffc107;">🎉 Recognition & Credits</h4>
            <p>We believe in recognizing our contributors! All contributors are listed in project credits, featured in release notes, and invited to join the core team for ongoing involvement.</p>
          </div>
        </section>

        <footer class="footer">
          <p>🔥 LED Matrix Project Documentation</p>
          <p>
            Built with modern web technologies and comprehensive Python
            integration
          </p>
          <div style="margin-top: 20px">
            <a href="/control" class="nav-link" style="margin: 0 10px"
              >🎮 Control Interface</a
            >
            <a
              href="https://github.com/your-repo"
              class="nav-link secondary"
              style="margin: 0 10px"
              >📦 GitHub</a
            >
          </div>
        </!--ter>
      </div>
    </div>

    <script src="mermaid-config.js"></script>
    <script>
      // Enhanced documentation functionality
      class DocumentationApp {
        constructor() {
          this.initializeMermaid();
          this.setupNavigation();
          this.setupInteractivity();
        }

        initializeMermaid() {
          // Initialize Mermaid with custom config
          mermaid.initialize({
            theme: "dark",
            themeVariables: {
              primaryColor: "#1a1a2e",
              primaryTextColor: "#f1f1f1",
              primaryBorderColor: "#e94560",
              lineColor: "#e94560",
              secondaryColor: "#16213e",
              tertiaryColor: "#0f3460",
              cScale0: "#1a1a2e",
              cScale1: "#16213e",
              cScale2: "#0f3460",
              cScale3: "#e94560",
              labelTextColor: "#f1f1f1",
              edgeLabelBackground: "rgba(26, 26, 46, 0.9)",
              clusterBkg: "rgba(15, 52, 96, 0.3)",
              clusterBorder: "#e94560",
            },
            flowchart: {
              useMaxWidth: true,
              htmlLabels: true,
              curve: "basis",
            },
            securityLevel: "loose",
            startOnLoad: true,
          });
        }

        setupNavigation() {
          // Smooth scrolling for navigation links
          document.querySelectorAll('a[href^="#"]').forEach((anchor) => {
            anchor.addEventListener("click", function (e) {
              e.preventDefault();
              const target = document.querySelector(this.getAttribute("href"));
              if (target) {
                target.scrollIntoView({
                  behavior: "smooth",
                  block: "start",
                });
              }
            });
          });

          // Update active navigation link
          window.addEventListener("scroll", () => {
            const sections = document.querySelectorAll(".section");
            const navLinks = document.querySelectorAll(".toc a");

            let current = "";
            sections.forEach((section) => {
              const sectionTop = section.offsetTop;
              if (scrollY >= sectionTop - 200) {
                current = section.getAttribute("id");
              }
            });

            navLinks.forEach((link) => {
              link.classList.remove("active");
              if (link.getAttribute("href") === "#" + current) {
                link.classList.add("active");
              }
            });
          });
        }

        setupInteractivity() {
          // Add diagram controls after DOM is loaded
          setTimeout(() => {
            this.addDiagramControls();
          }, 1000);
        }

        addDiagramControls() {
          document
            .querySelectorAll(".mermaid-container")
            .forEach((container) => {
              if (!container.querySelector(".mermaid-controls")) {
                const controls = document.createElement("div");
                controls.className = "mermaid-controls";
                controls.innerHTML = `
                            <button class="mermaid-control-btn" onclick="docApp.zoomDiagram(this, 1.2)" title="Zoom In">
                                <i class="fas fa-search-plus"></i>
                            </button>
                            <button class="mermaid-control-btn" onclick="docApp.zoomDiagram(this, 0.8)" title="Zoom Out">
                                <i class="fas fa-search-minus"></i>
                            </button>
                            <button class="mermaid-control-btn" onclick="docApp.resetDiagram(this)" title="Reset View">
                                <i class="fas fa-expand-arrows-alt"></i>
                            </button>
                            <button class="mermaid-control-btn" onclick="docApp.downloadDiagram(this)" title="Download SVG">
                                <i class="fas fa-download"></i>
                            </button>
                        `;
                container.appendChild(controls);
              }
            });
        }

        zoomDiagram(button, factor) {
          const container = button.closest(".mermaid-container");
          const diagram = container.querySelector(".mermaid");
          const currentTransform = diagram.style.transform || "scale(1)";
          const currentScale = parseFloat(
            currentTransform.match(/scale\(([^)]+)\)/)?.[1] || 1
          );
          const newScale = Math.max(0.1, Math.min(3, currentScale * factor));
          diagram.style.transform = `scale(${newScale})`;
        }

        resetDiagram(button) {
          const container = button.closest(".mermaid-container");
          const diagram = container.querySelector(".mermaid");
          diagram.style.transform = "scale(1)";
        }

        downloadDiagram(button) {
          const container = button.closest(".mermaid-container");
          const svg = container.querySelector("svg");
          if (svg) {
            const svgData = new XMLSerializer().serializeToString(svg);
            const blob = new Blob([svgData], { type: "image/svg+xml" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = "wiring-diagram.svg";
            a.click();
            URL.revokeObjectURL(url);
          }
        }

        async generateCustomDiagram() {
          const controller =
            document.getElementById("diagram-controller").value;
          const width = parseInt(
            document.getElementById("diagram-width").value
          );
          const height = parseInt(
            document.getElementById("diagram-height").value
          );

          const container = document.getElementById("custom-diagram-container");
          container.innerHTML =
            '<div style="text-align: center; padding: 20px; color: var(--text-muted);">Generating diagram...</div>';

          try {
            // Call the Python API to generate wiring diagram
            const response = await fetch("http://localhost:8080/wiring", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ controller, width, height }),
            });

            if (response.ok) {
              const data = await response.json();
              // Extract Mermaid diagram from the guide
              const mermaidMatch = data.guide.match(
                /```mermaid\n([\s\S]*?)\n```/
              );
              if (mermaidMatch) {
                const diagramCode = mermaidMatch[1];
                this.renderCustomDiagram(
                  diagramCode,
                  controller,
                  width,
                  height
                );
              } else {
                container.innerHTML =
                  '<div style="text-align: center; padding: 20px; color: var(--error);">No diagram found in response</div>';
              }
            } else {
              throw new Error("Failed to generate diagram");
            }
          } catch (error) {
            console.error("Error generating diagram:", error);
            container.innerHTML = `
                        <div style="text-align: center; padding: 20px; color: var(--error);">
                            <p>⚠️ Could not connect to Python controller</p>
                            <p style="font-size: 14px; margin-top: 10px;">Make sure the controller is running: <code>python matrix.py controller</code></p>
                        </div>
                    `;
          }
        }

        renderCustomDiagram(diagramCode, controller, width, height) {
          const container = document.getElementById("custom-diagram-container");
          const diagramId = "custom-diagram-" + Date.now();

          container.innerHTML = `
                    <div class="mermaid-container dynamic-diagram" style="margin-top: 30px;">
                        <h4>Custom ${controller
                          .replace("_", " ")
                          .toUpperCase()} - ${width}×${height}</h4>
                        <div class="mermaid" id="${diagramId}">${diagramCode}</div>
                    </div>
                `;

          // Re-initialize Mermaid for the new diagram
          mermaid.init(undefined, document.getElementById(diagramId));

          // Add controls to the new diagram
          setTimeout(() => {
            this.addDiagramControls();
          }, 500);
        }
      }

      // Initialize the documentation app
      const docApp = new DocumentationApp();

      // Global functions for button clicks
      window.generateCustomDiagram = () => docApp.generateCustomDiagram();
      window.docApp = docApp;

      // Search functionality
      const searchInput = document.getElementById("search-input");
      const searchResults = document.getElementById("search-results");
      let searchIndex = [];

      // Build search index
      function buildSearchIndex() {
        const sections = document.querySelectorAll(".section");
        searchIndex = [];

        sections.forEach((section) => {
          const id = section.getAttribute("id");
          const title = section.querySelector("h2").textContent;
          const content = section.textContent.toLowerCase();

          // Add main section
          searchIndex.push({
            id: id,
            title: title,
            content: content,
            type: "section",
          });

          // Add subsections
          const subsections = section.querySelectorAll("h3, h4");
          subsections.forEach((sub) => {
            searchIndex.push({
              id: id,
              title: sub.textContent,
              content: sub.parentElement.textContent.toLowerCase(),
              type: "subsection",
            });
          });
        });
      }

      // Perform search
      function performSearch(query) {
        if (!query || query.length < 2) {
          searchResults.style.display = "none";
          return;
        }

        const results = searchIndex
          .filter(
            (item) =>
              item.content.includes(query.toLowerCase()) ||
              item.title.toLowerCase().includes(query.toLowerCase())
          )
          .slice(0, 8); // Limit to 8 results

        if (results.length === 0) {
          searchResults.innerHTML =
            '<div class="search-result">No results found</div>';
        } else {
          searchResults.innerHTML = results
            .map((result) => {
              const highlightedTitle = result.title.replace(
                new RegExp(query, "gi"),
                (match) => `<span class="search-highlight">${match}</span>`
              );
              return `<div class="search-result" onclick="navigateToSection('${
                result.id
              }')">
                      <strong>${highlightedTitle}</strong>
                      <br><small>${
                        result.type === "section" ? "Section" : "Subsection"
                      }</small>
                  </div>`;
            })
            .join("");
        }

        searchResults.style.display = "block";
      }

      // Navigate to section
      function navigateToSection(sectionId) {
        const section = document.getElementById(sectionId);
        if (section) {
          section.scrollIntoView({ behavior: "smooth", block: "start" });
          searchResults.style.display = "none";
          searchInput.value = "";
        }
      }

      // Search event listeners
      if (searchInput) {
        searchInput.addEventListener("input", (e) => {
          performSearch(e.target.value);
        });

        searchInput.addEventListener("focus", () => {
          if (searchInput.value.length >= 2) {
            searchResults.style.display = "block";
          }
        });
      }

      document.addEventListener("click", (e) => {
        if (!e.target.closest(".search-container")) {
          searchResults.style.display = "none";
        }
      });

      // Download functionality
      function generateCompleteGuide() {
        const content = document.querySelector(".main-content").cloneNode(true);

        // Remove interactive elements
        content
          .querySelectorAll(".nav-links, .mermaid-container")
          .forEach((el) => el.remove());

        const htmlContent = `<!DOCTYPE html>
<html>
<head>
    <title>LED Matrix Project - Complete Guide</title>
    <style>
        body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; max-width: 1200px; margin: 0 auto; padding: 20px; }
        h1, h2, h3 { color: #e94560; }
        h1 { font-size: 2.5rem; text-align: center; }
        h2 { font-size: 2rem; border-bottom: 2px solid #e94560; padding-bottom: 10px; }
        h3 { font-size: 1.5rem; }
        .highlight-box { background: #f0f0f0; padding: 15px; border-left: 4px solid #e94560; margin: 20px 0; }
        .code-block { background: #f5f5f5; padding: 15px; font-family: monospace; border: 1px solid #ddd; margin: 15px 0; }
        table { border-collapse: collapse; width: 100%; margin: 20px 0; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        th { background-color: #f2f2f2; font-weight: bold; }
        ul, ol { margin: 15px 0; padding-left: 30px; }
        .component-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin: 20px 0; }
        .component-card { border: 1px solid #ddd; padding: 15px; border-radius: 8px; }
        @media print { body { font-size: 12px; } h1 { font-size: 1.8rem; } h2 { font-size: 1.4rem; } }
    </style>
</head>
<body>
    ${content.innerHTML}
</body>
</html>`;

        const blob = new Blob([htmlContent], { type: "text/html" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "LED_Matrix_Complete_Guide.html";
        a.click();
        URL.revokeObjectURL(url);
      }

      function generateWiringDiagrams() {
        let content = "# LED Matrix Wiring Diagrams\n\n";
        content += "Generated from LED Matrix Project Documentation\n\n";

        // Add basic wiring information
        content += "## Basic Arduino Uno Wiring\n\n";
        content += "```\nArduino Uno Connections:\n";
        content += "- Pin 6 → 330Ω Resistor → LED Strip DIN\n";
        content += "- 5V → LED Strip VCC (through external PSU)\n";
        content += "- GND → LED Strip GND\n";
        content += "- 1000µF Capacitor across VCC and GND\n```\n\n";

        content += "## ESP32 Wiring (with Level Shifter)\n\n";
        content += "```\nESP32 Connections:\n";
        content += "- Pin 13 → 74HCT125 Input\n";
        content += "- 74HCT125 Output → 330Ω Resistor → LED Strip DIN\n";
        content += "- 5V PSU → LED Strip VCC\n";
        content += "- 5V PSU → 74HCT125 VCC\n";
        content += "- Common GND for all components\n```\n\n";

        content += "## Power Supply Calculations\n\n";
        content += "- Each LED: 60mA maximum\n";
        content += "- 504 LEDs: 30.24A maximum\n";
        content += "- Recommended PSU: 5V 10A+ for typical use\n";
        content += "- Safety margin: 20% above calculated requirements\n\n";

        const blob = new Blob([content], { type: "text/markdown" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "LED_Matrix_Wiring_Diagrams.md";
        a.click();
        URL.revokeObjectURL(url);
      }

      function generateArduinoCodePack() {
        const content = `// LED Matrix Project - Arduino Code Examples
// Generated from project documentation

#include <FastLED.h>

#define DATA_PIN 6
#define NUM_LEDS 504
#define BRIGHTNESS 128

CRGB leds[NUM_LEDS];

void setup() {
    FastLED.addLeds<WS2812B, DATA_PIN, GRB>(leds, NUM_LEDS);
    FastLED.setBrightness(BRIGHTNESS);
    Serial.begin(115200);
    
    // Initialize with a test pattern
    fill_solid(leds, NUM_LEDS, CRGB::Red);
    FastLED.show();
    delay(1000);
    fill_solid(leds, NUM_LEDS, CRGB::Black);
    FastLED.show();
}

void loop() {
    // Read commands from serial
    if (Serial.available()) {
        String command = Serial.readString();
        command.trim();
        processCommand(command);
    }
    
    FastLED.show();
    delay(10);
}

void processCommand(String cmd) {
    if (cmd.startsWith("CLEAR")) {
        fill_solid(leds, NUM_LEDS, CRGB::Black);
    } else if (cmd.startsWith("RAINBOW")) {
        rainbow();
    } else if (cmd.startsWith("SOLID")) {
        // Format: SOLID,R,G,B
        int r = cmd.substring(6, cmd.indexOf(',', 6)).toInt();
        int g = cmd.substring(cmd.indexOf(',', 6) + 1, cmd.lastIndexOf(',')).toInt();
        int b = cmd.substring(cmd.lastIndexOf(',') + 1).toInt();
        fill_solid(leds, NUM_LEDS, CRGB(r, g, b));
    }
}

void rainbow() {
    for (int i = 0; i < NUM_LEDS; i++) {
        leds[i] = CHSV(i * 255 / NUM_LEDS, 255, 255);
    }
}

// Additional utility functions
void testPattern() {
    // Light up LEDs one by one for testing
    for (int i = 0; i < NUM_LEDS; i++) {
        leds[i] = CRGB::White;
        FastLED.show();
        delay(10);
        leds[i] = CRGB::Black;
    }
}

void matrixXY(int x, int y, CRGB color) {
    // Convert X,Y coordinates to LED index
    // Assumes serpentine wiring pattern
    int index;
    if (y % 2 == 0) {
        index = y * 21 + x;  // 21 LEDs wide
    } else {
        index = y * 21 + (20 - x);  // Reverse for serpentine
    }
    
    if (index >= 0 && index < NUM_LEDS) {
        leds[index] = color;
    }
}`;

        const blob = new Blob([content], { type: "text/plain" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "LED_Matrix_Arduino_Code_Pack.ino";
        a.click();
        URL.revokeObjectURL(url);
      }

      function generateShoppingList() {
        const csvContent = `Component,Specification,Quantity,Estimated Cost,Notes,Where to Buy
Arduino Uno,5V logic 16MHz ATmega328P,1,$15-25,Main controller,Amazon/Arduino Store
Arduino Nano,5V logic 16MHz ATmega328P,1,$10-20,Compact alternative,Amazon/AliExpress
ESP32 Dev Board,WiFi/Bluetooth dual-core,1,$15-30,Advanced features,Amazon/Espressif
WS2812B LED Strip,144 LEDs/meter addressable,3.5m,$40-60,Adjust based on matrix size,Amazon/Adafruit
5V Power Supply,10A+ switching PSU,1,$25-40,External PSU required,Amazon/Electronics stores
1000µF Capacitor,6.3V+ electrolytic,1,$2-5,Power smoothing,Electronics stores
330Ω Resistor,1/4W carbon film,1,$0.50,Data line protection,Electronics stores
Jumper Wires,Male-to-male various lengths,Set,$5-10,Connections and prototyping,Amazon/Electronics stores
Heavy Wire,18 AWG stranded copper,2m,$5-10,Power connections,Hardware stores
Breadboard,Half-size 400 tie-points,1,$5-10,Prototyping (optional),Electronics stores
Multimeter,Basic digital DMM,1,$15-30,Testing and debugging,Hardware stores
Soldering Kit,Iron + solder + flux,1,$20-40,Permanent connections,Electronics stores
Heat Shrink Tubing,Various sizes,Set,$5-10,Connection protection,Electronics stores
74HCT125,Level shifter IC (for ESP32),1,$2-5,3.3V to 5V logic,Electronics stores
Fuse Holder,5A blade fuse + holder,1,$3-8,Overcurrent protection,Auto parts stores
Project Box,Plastic enclosure,1,$10-20,Controller housing (optional),Electronics stores
Mounting Hardware,Screws and standoffs,Set,$5-15,Case mounting,Hardware stores

Total Estimated Cost:,$200-350,,"Varies by supplier and quality",Basic to complete setup,Multiple sources recommended`;

        const blob = new Blob([csvContent], { type: "text/csv" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "LED_Matrix_Shopping_List.csv";
        a.click();
        URL.revokeObjectURL(url);
      }

      // Download event listeners
      document
        .getElementById("download-guide")
        ?.addEventListener("click", (e) => {
          e.preventDefault();
          generateCompleteGuide();
        });

      document
        .getElementById("download-wiring")
        ?.addEventListener("click", (e) => {
          e.preventDefault();
          generateWiringDiagrams();
        });

      document
        .getElementById("download-code")
        ?.addEventListener("click", (e) => {
          e.preventDefault();
          generateArduinoCodePack();
        });

      document
        .getElementById("download-shopping")
        ?.addEventListener("click", (e) => {
          e.preventDefault();
          generateShoppingList();
        });

      // Initialize search index when page loads
      buildSearchIndex();

      // Interactive Assembly Guide
      let currentStep = 1;
      const totalSteps = 12;

      const assemblySteps = [
        {
          title: "Pre-Assembly Preparation 🛡️",
          content: "Essential preparation and safety setup"
        },
        {
          title: "Case Preparation 🏠", 
          content: "Remove drive bay covers and prepare workspace"
        },
        {
          title: "LED Strip Planning ✂️",
          content: "Calculate requirements and plan layout"
        },
        {
          title: "Power Supply Setup ⚡",
          content: "Configure external power supply safely"
        },
        {
          title: "Arduino Programming 💻",
          content: "Upload and test basic LED control code"
        },
        {
          title: "Initial LED Testing 🧪",
          content: "Test first 10 LEDs before full installation"
        },
        {
          title: "Matrix Layout 📐",
          content: "Plan and mark LED positions in serpentine pattern"
        },
        {
          title: "LED Installation 🔧",
          content: "Mount LED strips with proper spacing"
        },
        {
          title: "Power Wiring ⚡",
          content: "Connect power lines with heavy gauge wire"
        },
        {
          title: "Data Line Connection 📡",
          content: "Wire data line from Arduino to first LED"
        },
        {
          title: "Protection Components 🛡️",
          content: "Install capacitor and resistor for safety"
        },
        {
          title: "Final Testing & Integration 🎉",
          content: "Complete system test and Python integration"
        }
      ];

      function startAssemblyGuide() {
        document.getElementById('assembly-guide').style.display = 'block';
        document.getElementById('start-assembly-guide').style.display = 'none';
        updateAssemblyStep();
      }

      function updateAssemblyStep() {
        // Update progress bar
        const progress = (currentStep / totalSteps) * 100;
        document.getElementById('assembly-progress').style.width = progress + '%';
        
        // Update step counter
        document.getElementById('assembly-step-counter').textContent = `Step ${currentStep} of ${totalSteps}`;
        
        // Update navigation buttons
        document.getElementById('prev-step').disabled = currentStep === 1;
        document.getElementById('next-step').style.display = currentStep === totalSteps ? 'none' : 'inline-block';
        
        // Update step indicators
        const dots = document.querySelectorAll('.step-dot');
        dots.forEach((dot, index) => {
          if (index < currentStep) {
            dot.style.background = '#4caf50';
          } else {
            dot.style.background = 'rgba(233, 69, 96, 0.3)';
          }
        });
      }

      function nextAssemblyStep() {
        if (currentStep < totalSteps) {
          currentStep++;
          updateAssemblyStep();
          
          // Simulate step content update (in real implementation, this would show different content)
          if (currentStep <= assemblySteps.length) {
            const stepData = assemblySteps[currentStep - 1];
            // Update step content dynamically
            console.log(`Moving to: ${stepData.title} - ${stepData.content}`);
          }
        }
      }

      function prevAssemblyStep() {
        if (currentStep > 1) {
          currentStep--;
          updateAssemblyStep();
        }
      }

      // LED Calculator functionality
      function updateLEDCalculator() {
        const width = parseInt(document.getElementById('calc-width')?.value || 21);
        const height = parseInt(document.getElementById('calc-height')?.value || 24);
        const totalLEDs = width * height;
        const stripLength = (totalLEDs / 144).toFixed(1); // 144 LEDs per meter
        const maxCurrent = (totalLEDs * 0.06).toFixed(2); // 60mA per LED
        
        const resultsDiv = document.getElementById('calc-results');
        if (resultsDiv) {
          resultsDiv.innerHTML = `
            Total LEDs: <strong>${totalLEDs}</strong><br>
            Strip Length: <strong>${stripLength}m</strong><br>
            Max Current: <strong>${maxCurrent}A</strong>
          `;
        }
      }

      // Event listeners for assembly guide
      document.getElementById('start-assembly-guide')?.addEventListener('click', startAssemblyGuide);
      document.getElementById('next-step')?.addEventListener('click', nextAssemblyStep);
      document.getElementById('prev-step')?.addEventListener('click', prevAssemblyStep);
      
      // Event listeners for LED calculator
      document.getElementById('calc-width')?.addEventListener('input', updateLEDCalculator);
      document.getElementById('calc-height')?.addEventListener('input', updateLEDCalculator);

      // Interactive checklist functionality
      document.addEventListener('change', (e) => {
        if (e.target.type === 'checkbox' && e.target.closest('.interactive-checklist')) {
          const checklist = e.target.closest('.interactive-checklist');
          const checkboxes = checklist.querySelectorAll('input[type="checkbox"]');
          const checked = checklist.querySelectorAll('input[type="checkbox"]:checked');
          
          if (checked.length === checkboxes.length) {
            // All items checked - show completion message
            const completionMsg = document.createElement('div');
            completionMsg.style.cssText = 'margin-top: 10px; padding: 10px; background: rgba(76, 175, 80, 0.2); border-radius: 4px; color: #4caf50; font-weight: bold;';
            completionMsg.textContent = '✅ Step completed! Ready to proceed.';
            
            // Remove existing completion message
            const existing = checklist.querySelector('.completion-message');
            if (existing) existing.remove();
            
            completionMsg.className = 'completion-message';
            checklist.appendChild(completionMsg);
          }
        }
      });
    </script>
  </body>
</html>
